<form id="student-form">
  <input type="text" name="firstname" placeholder="First name" required />
  <input type="text" name="lastname" placeholder="Last name" required />
  <input type="text" name="num_inscreption" placeholder="Registration number" required />
  <button type="submit">Check Credentials</button>
</form>

<div id="result"></div>

<script>
document.getElementById("student-form").addEventListener("submit", async (e) => {
  e.preventDefault();
  const form = e.target;
  const params = new URLSearchParams(new FormData(form)).toString();
  const response = await fetch(`/get_credentials/?${params}`);
  const resultDiv = document.getElementById("result");

  if (response.ok) {
    const data = await response.json();
    resultDiv.innerHTML = `
      <p><strong>Username:</strong> ${data.username}</p>
      <p><strong>Password:</strong> ${data.password}</p>
      <button onclick="downloadPDF('${form.firstname.value}','${form.lastname.value}','${form.num_inscreption.value}')">Download PDF</button>
    `;
  } else {
    const err = await response.json();
    resultDiv.innerHTML = `<p style="color:red;">${err.error}</p>`;
  }
});

async function downloadPDF(firstname, lastname, num_inscreption) {
  const params = new URLSearchParams({ firstname, lastname, num_inscreption }).toString();
  window.open(`/get_credentials_pdf/?${params}`, "_blank");
}
</script>